# File generated by chatgpt, will see if it is useful
# Use an official Node.js runtime based on Alpine for a lightweight base
# Slim works better than alpine for certain libraries
FROM node:22-slim

# Set the working directory
WORKDIR /app

# RUN corepack enable && corepack prepare yarn@stable --activate
# Install Yarn v4.4.0
RUN corepack enable && corepack prepare yarn@4.4.0 --activate

# Copy package.json, yarn.lock, and Yarn configuration files
COPY package.json yarn.lock .yarnrc.yml ./
#COPY .yarn .yarn

# Install dependencies, keeping dev dependencies for tsx usage
# Use --frozen-lockfile if dependencies are being updated on yarn.lock vs package.json version
# Use --immutable to ensure the dependencies match the lockfile exactly


#RUN yarn install 
RUN yarn install --immutable || (cat /tmp/xfs-*/build.log && exit 1)

# Copy the rest of the application source code
COPY . .

# Expose the port the app runs on
EXPOSE 8080

# Command to run the application using `yarn start`
CMD ["yarn", "start"]

